<?xml version="1.0" encoding="UTF-8" ?>
<!DOCTYPE mapper
PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN"
"http://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace="board">


	<select id="selectCnt" resultType="int">
		SELECT COUNT(1) FROM TB_BOARD_BASE 
		 WHERE B_CATEGORY = #{category}
	</select>
	
	
	<select id="selectPage" resultType="hashMap">
			SELECT * 
		FROM (
			SELECT ROWNUM RN, A.* 
				FROM (
						SELECT * FROM TB_BOARD_BASE  A1 
				  	             ,(SELECT COUNT(1) CNT, B_SEQ AS SEQ FROM TB_BOARD_DTLS GROUP BY B_SEQ )  B1 
				  	    WHERE A1.B_SEQ  = B1.SEQ
				  	     AND  A1.B_CATEGORY = #{category}
						ORDER BY TO_NUMBER(A1.B_SEQ) DESC
						) A
				)
		WHERE RN BETWEEN #{start} AND #{end}
	</select>
	

	<select id="selectList" resultType="hashMap">
	  	SELECT * FROM TB_BOARD_BASE  A 
  	             ,(SELECT COUNT(1) CNT, B_SEQ FROM TB_BOARD_DTLS GROUP BY B_SEQ )  B 
  	    WHERE A.B_SEQ  = B.B_SEQ
		ORDER BY TO_NUMBER(A.B_SEQ) DESC
	</select>
		
	<select id="selectOne">
		SELECT * 
		   FROM TB_BOARD_BASE A 
			   ,TB_BOARD_DTLS B
		  WHERE A.B_SEQ = B.B_SEQ 
		    AND A.B_SEQ = #{seq}

	</select>
	
	<select id="selectKey" resultType="String">
		SELECT NVL(MAX(TO_NUMBER(B_SEQ)) , 0) +1 FROM TB_BOARD_BASE
	</select>
	
	<select id="selectReply" resultType="String">
		SELECT NVL(MAX(TO_NUMBER(B_REPLY)) , 0) +1 FROM TB_BOARD_BASE
		WHERE B_SEQ = #{seq} 
	</select>

	
	<insert id="insertBase">
		INSERT INTO TB_BOARD_BASE
			(
			  B_SEQ
			, B_CATEGORY
			, B_USER
			, B_NOTICE_YN
			, B_IMG_PATH
			, B_TITLE
			, B_CRTR
			, B_REPLY
			, B_DEEP
			, B_REG_DATE
			, B_REG_USER
			, B_MOD_DATE
			, B_MOD_USER) 
			VALUES 
				(
		   	  #{seq} 
			, #{category}
			, #{user}
			, #{noticeYn}
			, #{imgPath}
			, #{title}
			, #{crtr}
			, #{reply}
			, #{deep}
			, SYSDATE
			, #{regUser}
			, SYSDATE
			, #{modUser} 
			)
	</insert>
	
	<insert id="insertDtls">
		
		INSERT INTO TB_BOARD_DTLS
		(
		  B_SEQ
		, B_CRTR
		, B_REPLY
		, B_DEEP
		, B_CONTENTS
		, B_REG_DATE
		, B_REG_USER
		, B_MOD_DATE
		, B_MOD_USER) 
		VALUES 
			( 
		 	  #{seq} 
			, #{crtr}
			, #{reply}
			, #{deep}
			, #{contents}
			, SYSDATE
			, #{regUser}
			, SYSDATE  
			, #{modUser}
		)
	</insert>
	
	<update id="updateBase">
	
	</update>
	
	<update id="updateDtls">
	
	</update>
	
	
</mapper>












